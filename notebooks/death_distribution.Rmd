---
title: "Death distribution"
output: html_notebook
---
```{r}
library(dplyr)
library(lubridate)
library(zoo)
ad <- read.csv("../data/lt-covid19-agedist.csv") %>% mutate(day = ymd(day))
agr <- read.csv("../raw_data/agegroups2.csv")
```

```{r}
tad <- ad %>% inner_join(agr) %>% group_by(day, age1) %>% summarise(deaths_population_daily = sum(deaths_population_daily), deaths = sum(deaths_3_daily)) %>% ungroup %>% 
    arrange(age1, day) %>% group_by(age1) %>% 
    mutate(dp = rollsum(deaths_population_daily, 7, fill = NA, align = "right"),
           dc = rollsum(deaths, 7, fill = NA, align = "right")) %>% 
    ungroup %>%     
    mutate(p = ifelse( deaths_population_daily>0, round(100*deaths/deaths_population_daily,2),0),
           p1= ifelse( dp>0, round(100*dc/dp,2),0) )

```

```{r}
ggplot(aes(x = day, y = deaths_population_daily), data = tad)+geom_line()+geom_line(aes(y=deaths), colour ="red")+facet_wrap(~age1, scales = "free_y")+theme_bw() + labs(x = "Data", y = "Mirtys", title = "Visos mirtys Lietuvoje ir mirtys nuo covid-19 pagal amžiaus grupes")
```

```{r}
ggplot(aes(x = day, y = p1), data = tad)+geom_line()+facet_wrap(~age1, scales = "free_y")+theme_bw() + labs(x = "Data", y = "Procentai", title = "Covid-19 mirčių procentas tarp visų mirčių pagal amžiaus grupes (7 dienų vidurkis)")
```


```{r}
ggplot(aes(x = day, y = p), data = tad)+geom_line()+facet_wrap(~age1, scales = "free_y")+theme_bw() + labs(x = "Data", y = "Procentai", title = "Covid-19 mirčių procentas tarp visų mirčių pagal amžiaus grupes")
```